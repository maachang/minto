# jhtml ドキュメント

jhtmlテンプレートファイル（`.mt.html`）をJavaScriptコードに変換する超シンプルなテンプレートエンジンモジュール。

---

## 概要

jhtmlテンプレートでは、HTMLテンプレート内にJavaScriptコードを埋め込む独自のテンプレート構文を解析し、実行可能なJavaScriptコードへ変換します。変換後のコードは`exports.handler`として非同期関数にラップされ、実行結果としてHTML文字列を返却します。

jhtmlテンプレートの埋め込み構文は以下のようになります。

- **テンプレート構文** — `<% %>`, `<%= %>`, `<%# %>`, `${ }` の4種類の埋め込みタグの説明と使用例
- **組み込み機能** — `$out`, `$request`, `$response` の説明

また、この jhtml テンプレートファイルは、aws lambda 上では利用されず `mtpk` コマンドで、対象プロジェクトをデプロイする時に `mt.js` ファイルに変換される。

---

## テンプレート構文

### `<% ... %>` — コード埋め込み

テンプレート内にJavaScriptコードを埋め込みます。出力は行われず、制御構文（`if`、`for`など）の記述に使用します。

```html
<% if (showHeader) { %>
  <h1>ヘッダー</h1>
<% } %>
```

### `<%= ... %>` — 式の出力

JavaScriptの式を評価し、結果をHTML出力に挿入します。末尾のセミコロンは自動的に除去されます。

```html
<p>ユーザー名: <%= user.name %></p>
```

### `<%# ... %>` — コメント

コメント用タグ。変換後のJavaScriptには一切出力されません。

```html
<%# ここはコメントです。出力されません。 %>
```

### `${ ... }` — テンプレート式（出力のショートハンド）

`<%= ... %>`と同等の機能を持つ簡略記法です。主に変数出力時の利用を推奨します。ネストした波括弧やクォーテーション内の波括弧も正しく処理されます。

```html
<p>ユーザー名: ${user.name}</p>
<p>合計: ${items.reduce((a, b) => a + b, 0)}</p>
```

---

## テンプレート内で使用可能な組み込み機能

| 名前 | 種別 | 説明 |
|---|---|---|
| `$out` | Function | 文字列をHTML出力に追加する関数。戻り値が`$out`自身のため、`$out("abc")("def")`のようにチェーン呼び出しが可能。 |
| `$request` | Object | リクエストオブジェクト。|
| `$response` | Object | レスポンスオブジェクト。 |

---

## jhtml サンプル

**使用例:**

```html
<%
    const title = "テストタイトル";
    const items = [];
    item.push("hoge");
    item.push("moge");
%>
<html>
<body>
  <h1><%= title %></h1>
  <ul>
  <% for (let i = 0; i < items.length; i++) { %>
    <li>${items[i]}</li>
  <% } %>
  </ul>
</body>
</html>
```

---
